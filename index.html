<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–º—ñ—á–Ω–∏–∫</title>
    <style>
        :root { --prm: #007bff; --bg: #f0f2f5; }
        body { font-family: sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; width: 100%; max-width: 400px; }
        #mic-btn { width: 80px; height: 80px; border-radius: 50%; border: none; background: var(--prm); color: white; font-size: 30px; cursor: pointer; margin: 20px 0; }
        #mic-btn.listening { background: #ff4757; animation: pulse 1s infinite; }
        .item { background: white; margin: 10px 0; padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; border-left: 5px solid var(--prm); width: 100%; max-width: 400px; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div class="card">
    <h2>–ú—ñ–π –ü–æ–º—ñ—á–Ω–∏–∫</h2>
    <p id="status">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –º—ñ–∫—Ä–æ—Ñ–æ–Ω</p>
    <button id="mic-btn">üé§</button>
    <div id="output" style="color: #666; min-height: 1.5em;"></div>
</div>
<div id="list" style="margin-top: 20px; width: 100%; max-width: 400px;"></div>

<script>
// --- –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø ---
const TG_TOKEN = '8586679119:AAGw0ifsSKupw1JFfG5Nz4P8pqkB8mEbLXE'; 
const TG_CHAT_ID = '1203975708';

const btn = document.getElementById('mic-btn');
const status = document.getElementById('status');
const output = document.getElementById('output');
const listEl = document.getElementById('list');

// 1. –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –ì–û–õ–û–°–£ (–©–û–ë –ù–ï –ë–£–õ–û –ù–Ü–ú–ï–¶–¨–ö–û–á)
let ukrainianVoice = null;
function loadVoices() {
    const voices = window.speechSynthesis.getVoices();
    ukrainianVoice = voices.find(v => v.lang === 'uk-UA' || v.lang === 'uk_UA');
}
window.speechSynthesis.onvoiceschanged = loadVoices;
loadVoices();

function speak(msg) {
    // –ó—É–ø–∏–Ω—è—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—î –º–æ–≤–ª–µ–Ω–Ω—è
    window.speechSynthesis.cancel();

    const utter = new SpeechSynthesisUtterance(msg);
    
    // –û—Ç—Ä–∏–º—É—î–º–æ —Å–ø–∏—Å–æ–∫ —É—Å—ñ—Ö –≥–æ–ª–æ—Å—ñ–≤ —É —Å–∏—Å—Ç–µ–º—ñ
    const voices = window.speechSynthesis.getVoices();
    
    // –®—É–∫–∞—î–º–æ —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π –≥–æ–ª–æ—Å –∑–∞ –∫–æ–¥–æ–º –º–æ–≤–∏
    const ukVoice = voices.find(v => v.lang.startsWith('uk'));

    if (ukVoice) {
        utter.voice = ukVoice;
    } else {
        console.warn("–£–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π –≥–æ–ª–æ—Å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –ë—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ —Å–∏—Å—Ç–µ–º–Ω–∏–π.");
    }

    utter.lang = 'uk-UA';
    utter.pitch = 1.0;
    utter.rate = 1.0; // –®–≤–∏–¥–∫—ñ—Å—Ç—å (–º–æ–∂–Ω–∞ –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ 0.9 –¥–ª—è –ø–æ–≤—ñ–ª—å–Ω—ñ—à–æ–≥–æ –º–æ–≤–ª–µ–Ω–Ω—è)

    window.speechSynthesis.speak(utter);
}

// –î–æ–¥–∞—Ç–∫–æ–≤–∏–π —Ñ—ñ–∫—Å –¥–ª—è Chrome: –∑–º—É—à—É—î–º–æ –æ–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ –≥–æ–ª–æ—Å—ñ–≤
window.speechSynthesis.onvoiceschanged = () => {
    window.speechSynthesis.getVoices();
};

// –î–æ–¥–∞—Ç–∫–æ–≤–∏–π —Ñ—ñ–∫—Å –¥–ª—è Chrome: –∑–º—É—à—É—î–º–æ –æ–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ –≥–æ–ª–æ—Å—ñ–≤
window.speechSynthesis.onvoiceschanged = () => {
    window.speechSynthesis.getVoices();
};

// 2. –†–û–ó–ü–Ü–ó–ù–ê–í–ê–ù–ù–Ø –ú–û–í–ò
const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
if (Speech) {
    const recognition = new Speech();
    recognition.lang = 'uk-UA';

    btn.onclick = () => {
        try { recognition.start(); } catch(e) {}
    };

    recognition.onstart = () => {
        btn.classList.add('listening');
        status.innerText = "–Ø —Å–ª—É—Ö–∞—é...";
    };

    recognition.onresult = (e) => {
        const text = e.results[0][0].transcript.toLowerCase();
        output.innerText = `¬´${text}¬ª`;
        parseText(text);
    };

    recognition.onend = () => {
        btn.classList.remove('listening');
        status.innerText = "–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –º—ñ–∫—Ä–æ—Ñ–æ–Ω";
    };
}

// 3. –û–ë–†–û–ë–ö–ê –¢–ï–ö–°–¢–£
function parseText(text) {
    const timeMatch = text.match(/(\d{1,2})[:.\s](\d{2})/);
    if (timeMatch) {
        const now = new Date();
        let evTime = new Date(now);
        evTime.setHours(parseInt(timeMatch[1]), parseInt(timeMatch[2]), 0);
        if (evTime < now) evTime.setDate(evTime.getDate() + 1);
        
        const task = text.replace(/–Ω–∞–≥–∞–¥–∞–π|–º–µ–Ω—ñ|–ø—Ä–æ|–æ|–≤/g, '').trim() || "–ü–æ–¥—ñ—è";
        addReminder(task, evTime);
        speak(`–î–æ–±—Ä–µ, –Ω–∞–≥–∞–¥–∞—é –ø—Ä–æ ${task} –æ ${timeMatch[1]} ${timeMatch[2]}`);
    } else {
        speak("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∫–∞–∂—ñ—Ç—å —á–∞—Å");
    }
}

function addReminder(task, time) {
    const tasks = JSON.parse(localStorage.getItem('v_tasks') || '[]');
    tasks.push({ id: Date.now(), task, time: time.getTime() });
    localStorage.setItem('v_tasks', JSON.stringify(tasks));
    render();
}

function render() {
    const tasks = JSON.parse(localStorage.getItem('v_tasks') || '[]');
    listEl.innerHTML = tasks.map(t => `
        <div class="item">
            <div><strong>${t.task}</strong><br><small>${new Date(t.time).toLocaleTimeString()}</small></div>
            <button onclick="delT(${t.id})" style="border:none; background:none; color:red; cursor:pointer; font-size:20px;">‚úï</button>
        </div>
    `).join('');
}

window.delT = (id) => {
    let tasks = JSON.parse(localStorage.getItem('v_tasks') || '[]');
    tasks = tasks.filter(t => t.id !== id);
    localStorage.setItem('v_tasks', JSON.stringify(tasks));
    render();
};

render();
</script>
</body>
</html>


